(function(a){a.extend({getHash:function(){var b=location.hash.replace("#","");return b?b:""},getHashRoot:function(){return a.getHash().split("/")[0]},getHashArr:function(){return a.getHash().split("/")},getTpl:function(b,d){var c=a(b).html();if(!d){a(b).remove()}return c},compile:function(b,c){var d=b.match(/[{][{][^{}]+[}][}]/g);a.each(d,function(e,g){var f=a.trim(g.replace(/[{}]/g,""));b=b.replace(g,c[f])});return b}});a.fn.extend({loadMore:function(b){var e=a(document).scrollTop();var d=(b.isActive?b.isActive():false);var f=!a(b.selector).data("noMore");var c=!a(b.selector).data("ajaxActive");if(d&&f&&c){a(b.selector).data("ajaxActive",true);b.showLoading?b.showLoading():(function(){console.log("正在加载中...")})();a.ajax({url:b.url,type:"GET",data:a.extend(true,{page:a(b.selector).data("pageCounter")+1},b.args),dataType:"json",cache:false,error:function(i,g,h){b.error(h,i,g)},success:function(h,g,j){var i=h;a.each(i,function(l,m){var k=a.compile(b.template,m);a(b.selector)[b.handle?b.handle:"append"](k);b.appendCallback(a(b.selector).children(":last"),l,m)});a(b.selector).data("pageCounter",a(b.selector).data("pageCounter")+1);a(document).scrollTop(e);if(!i||i.length<b.maxLoadNum){a(b.selector).data("noMore",true);console.log("已经没有了,不再加载..")}a(b.selector).data("ajaxActive",false)},complete:function(h,g){b.hideLoading?b.hideLoading():(function(){console.log("正在加载中...")})();b.complete?b.complete(h,g):(function(){console.log("ajax完成")})()},});return{result:true}}else{return{result:false,log:{_isActive:d,_More:f,_ajaxActive:c}}}},buildLoadMoreModel:function(b){a(this).each(function(){a(b.selector).data("noMore",false);a(b.selector).data("ajaxActive",false);a(b.selector).data("pageCounter",0);b.template=!b.template&&b.templateId?a.getTpl("#"+b.templateId):b.template;var c=a(this);a.each(b.calls,function(d,e){a.fn.extend({_tmp:e});c._tmp(function(){return c.loadMore(b)})})});return a(this)}})})(jQuery);